// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("POSTGRES_URL")
}

model OAuthClient {
  id                      String   @id @map("client_id")
  clientSecret            String?  @map("client_secret")
  clientName              String?  @map("client_name")
  clientUri               String?  @map("client_uri")
  logoUri                 String?  @map("logo_uri")
  scope                   String?
  redirectUris            String[] @map("redirect_uris")
  grantTypes              String[] @map("grant_types")
  responseTypes           String[] @map("response_types")
  tokenEndpointAuthMethod String?  @map("token_endpoint_auth_method")
  jwksUri                 String?  @map("jwks_uri")
  jwks                    Json?
  softwareId              String?  @map("software_id")
  softwareVersion         String?  @map("software_version")
  createdAt               DateTime @default(now()) @map("created_at")
  updatedAt               DateTime @updatedAt @map("updated_at")

  // Relations
  authorizationCodes OAuthAuthorizationCode[]
  tokens             OAuthToken[]

  @@index([id])
  @@index([createdAt])
  @@map("oauth_clients")
}

model OAuthAuthorizationCode {
  id            String   @id @default(cuid()) @map("code_id")
  code          String   @unique
  clientId      String   @map("client_id")
  scopes        String[]
  resource      String?
  codeChallenge String?  @map("code_challenge")
  expiresAt     DateTime @map("expires_at")
  createdAt     DateTime @default(now()) @map("created_at")

  // Relations
  client OAuthClient @relation(fields: [clientId], references: [id], onDelete: Cascade)

  @@index([code])
  @@index([clientId])
  @@index([expiresAt])
  @@map("oauth_authorization_codes")
}

model OAuthToken {
  id        String   @id @default(cuid()) @map("token_id")
  token     String   @unique
  clientId  String   @map("client_id")
  scopes    String[]
  resource  String?
  tokenType String   @default("access") @map("token_type") // "access" or "refresh"
  expiresAt DateTime @map("expires_at")
  createdAt DateTime @default(now()) @map("created_at")

  // Relations
  client OAuthClient @relation(fields: [clientId], references: [id], onDelete: Cascade)

  @@index([token])
  @@index([clientId])
  @@index([expiresAt])
  @@index([tokenType])
  @@map("oauth_tokens")
}
